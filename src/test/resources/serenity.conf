serenity {
    take.screenshots = FOR_FAILURES
    take.screenshots = FOR_EACH_ACTION
    take.screenshots = AFTER_EACH_STEP
}

# Configuración por defecto para LOCAL
headless.mode = false

webdriver.base.url = "https://webx.muthematrix.com/"

webdriver {
  driver = chrome
  timeouts {
    implicitlywait = 10000
    pageload = 30000
  }
  capabilities {
    browserName = "chrome"
    acceptInsecureCerts = true
    "goog:chromeOptions" {
      args = ["remote-allow-origins=*","test-type", "no-sandbox", "ignore-certificate-errors", "start-maximized",
        "incognito", "disable-infobars", "disable-gpu", "disable-default-apps", "disable-popup-blocking",
        "disable-dev-shm-usage", "disable-extensions", "disable-web-security", "disable-translate", "disable-logging"]
    }
  }
}

environments {
  # ENTORNO LOCAL (por defecto)
  default {
    webdriver.base.url = "https://webx.muthematrix.com/"
  }

  # ENTORNO CI (solo se usa cuando pasas -Denvironment=ci)
  ci {
    webdriver.base.url = "https://webx.muthematrix.com/"
    headless.mode = true
    webdriver {
      timeouts {
        implicitlywait = 15000
        pageload = 40000
      }
      capabilities {
        "goog:chromeOptions" {
          args = [
            "remote-allow-origins=*",
            "no-sandbox",
            "ignore-certificate-errors",
            "incognito",
            "disable-infobars",
            "disable-gpu",
            "disable-dev-shm-usage",
            "disable-extensions",
            "headless=new",           # ← Usar headless moderno
            "window-size=1920,1080",
            "--disable-blink-features=AutomationControlled",  # ← NUEVO: Evita detección
            "--user-agent=Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"  # ← NUEVO: User-agent real
          ]
          excludeSwitches = ["enable-automation"]  # ← NUEVO: Oculta automation
        }
      }
    }
    serenity {
      step.delay = 1000  # ← NUEVO: Delay entre steps
      timeout = 30000    # ← NUEVO: Timeout general
    }
  }
}